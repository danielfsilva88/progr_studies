from kafka import KafkaConsumer

topic_name = "volume-topic-v2"
batch_size = 1000
poll_timeout = 100
consumer = KafkaConsumer(
  topic_name, 
  bootstrap_servers=["localhost:9092"], 
  auto_offset_reset='earliest',
  group_id='consumer_group_test'
)

messages = consumer.poll(timeout_ms=poll_timeout, max_records=batch_size)


>>> messages
{TopicPartition(topic='volume-topic-v2', partition=0): [ConsumerRecord(topic='volume-topic-v2', partition=0, offset=100000, timestamp=1711931211574, timestamp_type=0, key=None, value=b'{"msg_id": 0, "msg": "Message 0", "msg_timestamp": "2024-03-31 21:26:51"}', headers=[], checksum=None, serialized_key_size=-1, serialized_value_size=73, serialized_header_size=-1), ConsumerRecord(topic='volume-topic-v2', partition=0, offset=100001, timestamp=1711931211575, timestamp_type=0, key=None, value=b'{"msg_id": 1, "msg": "Message 1", "msg_timestamp": "2024-03-31 21:26:51"}', headers=[], checksum=None, serialized_key_size=-1, serialized_value_size=73, serialized_header_size=-1), ConsumerRecord(topic='volume-topic-v2', partition=0, offset=100002, timestamp=1711931211575, timestamp_type=0, key=None, value=b'{"msg_id": 2, "msg": "Message 2", "msg_timestamp": "2024-03-31 21:26:51"}', headers=[], checksum=None, serialized_key_size=-1, serialized_value_size=73, serialized_header_size=-1), ConsumerRecord(topic='volume-topic-v2', partition=0, offset=100003, timestamp=1711931211576, timestamp_type=0, key=None, value=b'{"msg_id": 3, "msg": "Message 3", "msg_timestamp": "2024-03-31 21:26:51"}', headers=[], checksum=None, serialized_key_size=-1, serialized_value_size=73, serialized_header_size=-1), ConsumerRecord(topic='volume-topic-v2', partition=0, offset=100004, timestamp=1711931211576, timestamp_type=0, key=None, value=b'{"msg_id": 4, "msg": "Message 4", "msg_timestamp": "2024-03-31 21:26:51"}', headers=[], checksum=None, serialized_key_size=-1, serialized_value_size=73, serialized_header_size=-1), ConsumerRecord(topic='volume-topic-v2', partition=0, offset=100005, timestamp=1711931211576, timestamp_type=0, key=None, value=b'{"msg_id": 5, "msg": "Message 5", "msg_timestamp": "2024-03-31 21:26:51"}', headers=[], checksum=None, serialized_key_size=-1, serialized_value_size=73, serialized_header_size=-1), ConsumerRecord(topic='volume-topic-v2', partition=0, offset=100006, timestamp=1711931211576, timestamp_type=0, key=None, value=b'{"msg_id": 6, "msg": "Message 6", "msg_timestamp": "2024-03-31 21:26:51"}', headers=[], checksum=None, serialized_key_size=-1, serialized_value_size=73, serialized_header_size=-1), ConsumerRecord(topic='volume-topic-v2', partition=0, offset=100007, timestamp=1711931211577, timestamp_type=0, key=None, value=b'{"msg_id": 7, "msg": "Message 7", "msg_timestamp": "2024-03-31 21:26:51"}', headers=[], checksum=None, serialized_key_size=-1, serialized_value_size=73, serialized_header_size=-1), ConsumerRecord(topic='volume-topic-v2', partition=0, offset=100008, timestamp=1711931211577, timestamp_type=0, key=None, value=b'{"msg_id": 8, "msg": "Message 8", "msg_timestamp": "2024-03-31 21:26:51"}', headers=[], checksum=None, serialized_key_size=-1, serialized_value_size=73, serialized_header_size=-1), ConsumerRecord(topic='volume-topic-v2', partition=0, offset=100009, timestamp=1711931211578, timestamp_type=0, key=None, value=b'{"msg_id": 9, "msg": "Message 9", "msg_timestamp": "2024-03-31 21:26:51"}', headers=[], checksum=None, serialized_key_size=-1, serialized_value_size=73, serialized_header_size=-1)]}
vals = messages.values()
[(v.value.decode("utf-8"), format_kafka_time(v.timestamp)) for v in list(vals)[0]]
[('{"msg_id": 0, "msg": "Message 0", "msg_timestamp": "2024-03-31 21:26:51"}', '2024-03-31 21:26:51'), ('{"msg_id": 1, "msg": "Message 1", "msg_timestamp": "2024-03-31 21:26:51"}', '2024-03-31 21:26:51'), ('{"msg_id": 2, "msg": "Message 2", "msg_timestamp": "2024-03-31 21:26:51"}', '2024-03-31 21:26:51'), ('{"msg_id": 3, "msg": "Message 3", "msg_timestamp": "2024-03-31 21:26:51"}', '2024-03-31 21:26:51'), ('{"msg_id": 4, "msg": "Message 4", "msg_timestamp": "2024-03-31 21:26:51"}', '2024-03-31 21:26:51'), ('{"msg_id": 5, "msg": "Message 5", "msg_timestamp": "2024-03-31 21:26:51"}', '2024-03-31 21:26:51'), ('{"msg_id": 6, "msg": "Message 6", "msg_timestamp": "2024-03-31 21:26:51"}', '2024-03-31 21:26:51'), ('{"msg_id": 7, "msg": "Message 7", "msg_timestamp": "2024-03-31 21:26:51"}', '2024-03-31 21:26:51'), ('{"msg_id": 8, "msg": "Message 8", "msg_timestamp": "2024-03-31 21:26:51"}', '2024-03-31 21:26:51'), ('{"msg_id": 9, "msg": "Message 9", "msg_timestamp": "2024-03-31 21:26:51"}', '2024-03-31 21:26:51')]